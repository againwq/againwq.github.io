[{"content":"一、sinx泰勒展开的C实现 1.sinx泰勒展开公式 sinx的泰勒展开如下： $$ sinx = x - \\frac{x^3}{3!} + \\frac{x^5}{5!} - \\frac{x^7}{7!} + \u0026hellip; + \\frac{(-1)^n}{(2n + 1)!}x^{2n+1} $$\n其中n从0开始计算，我采用的公式形态上是x=0处的泰勒展开。实际上我们可以把x写成$x = x + x_0$来实现$x=x_0$处的展开\n2.C实现sinx泰勒展开 我们通过控制精度来控制展开项数，并且我们只考虑$0-2\\pi$的范围，归一化处理我们之后再详细考虑，通过泰勒展开公式我们的C程序如下，\n#include \u0026lt;math.h\u0026gt; #define degree 1e-2 float fun_sin(float x) { float res, term; int i; int factor; // 阶乘 term = x; // 每一项的结果 factor = 1; res = term; for (i = 1; fabs(term) \u0026gt; degree; i++) { factor *= (2 * i) * (2 * i + 1); term = pow(-1, i) * pow(x, 2 * i + 1) / factor; res += term; } return res; } 上面的代码基本是严格按照公式计算的，可惜的是它并不能正常工作，这涉及到计算阶乘时整数溢出的问题。当输入比较小，比如0.2，那么大概在第二项就达到了我们设定的精度0.01了，此时factor为6，但是如果输入为6.23左右时，我们要计算10项以上才能达到我们设定的精度，第10项需要计算21的阶乘，即便使用64位无符号整型存储也不够，因此我们需要对其进行一定的优化\n二、sinx泰勒展开优化 1.通过固定计算的阶数来保证不溢出 很容易想到的一点就是我们可以通过固定展开的项数来保证计算过程不会溢出，比如我们固定每次展开项数为7，C程序如下\n#include \u0026lt;math.h\u0026gt; #define TIMES 7 float fun_sin(float x) { float res, term; int i; unsigned long factor; factor = 1; res = x; for (i = 1; i \u0026lt; TIMES; i++) { factor *= (2 * i) * (2 * i + 1); res += pow(-1, i) * pow(x, 2 * i + 1) / factor; } return res; } 2.从公式出发 观察sinx的泰勒展开我们可以得到如下规律：\n记第i项展开式为 $a_i = \\frac{(-1)^i}{(2i + 1)!}x^{2i+1}$ 则有 $a_i = a_{i-1} \\cdot \\frac{-x^2}{(2i)\\cdot(2i+1)}$ 我们可以看出相邻两项相差一个乘积因子$\\frac{-x^2}{(2i)\\cdot(2i+1)}$，而且这个因子中不会产生太大的数据导致数据溢出。这样我们可以保留通过精度控制展开项数的方法，而且不会产生数据溢出。实现的C程序如下：\n#include \u0026lt;math.h\u0026gt; #define pi 3.14159265 #define degree 1e-2\t// ̩精度设置 const float factor_diff_mem[10] = // 乘积因子的分母部分 { 1.0, 1.0 / 6, 1.0 / 20, 1.0 / 42, 1.0 / 72, 1.0 / 110, 1.0 / 156, 1.0 / 210, 1.0 / 272, 1.0 / 342 }; float fun_sin(float x) { float sum; float diff; int i; float term; sum = x; term = x; // 展开的每一项 diff = -1 * x * x; //乘积因子的分子部分 for (i = 1; fabs(term) \u0026gt; degree; i++) { term *= diff * factor_diff_mem[i]; sum += term; } return sum; } 这里我们也做了一些优化，我们不再在for循环中去计算因子的分母部分，而是在编译阶段直接计算出，程序运行时直接查表即可，这也是经典的空间换时间的优化方式。可以看到现在这个程序已经没有指数和阶乘这种费时又可能导致溢出的计算了\n三、三种方法时间比较 1.测试环境和代码 接下来我们将这两种方法和C标准库下的sinx进行时间上的比较，我采用的平台是x86_64，Debian 12系统，gcc12.2，测试代码如下：\nint get_us_time(){ struct timeval tv; gettimeofday(\u0026amp;tv, NULL); return tv.tv_usec; } int sinx_time_test(float (*fun_sin)(float), float *data, int n, int count) { int start, end; float x; int i, j; start = get_us_time(); for (j = 0; j \u0026lt; count; j++) // 周期数量 { for (i = 0; i \u0026lt;= n; i++) { x = 2 * pi * i / n; // 0-2pi取n个点 data[i] = fun_sin(x); // printf(\u0026#34;%f\\n\u0026#34;, data[i]); } } end = get_us_time(); return end - start; } 这里采用两层循环是为了更方便看到差距以外，还要保证一个周期内不要取太多点，导致输入的x精度过高，这里我们不对精度做太高要求,\n2.程序运行时间对比 三种方法程序运行时间如下：\nC standard Fixed degree Fixed items 184 us 266 us 1701 us 多次运行数值上的结果可能不一样，但是三者的关系基本不变，标准库的sinx最快，其次是我们优化后的固定精度的实现，最后是固定周期的实现。我们可以看到优化后的固定精度的实现和C标准库执行时间差不多，只有几十us的差距，但是固定周期的实现方法运行的时间却是其他两种方法的10倍，可见其效率之低。\n3.程序运行精度对比 我们借助gnuplot去绘制这三种方法的sinx曲线去大概对比精度，如图所示： 可以看到，当x逐渐变大时，固定周期的方法的精度以及出现非常明显的误差了，而我们优化后的固定精度的方法几乎是与标准库的实现完全重叠，甚至我们可以尝试继续调小精度来提升程序运行速度\n四、输入归一化处理 前面我们以及实现了速度接近标准库实现的泰勒展开，但是范围被限定在$(-2\\pi, 2\\pi)$之间，其实我们也可以输入超过这个范围的数据，但是随着输入的绝对值的变大，为了保证相同的精度，泰勒展开项数会逐渐增多，程序运行速度会越来越慢，最后很有有可能导致精度再次溢出。我们不希望不同的输入对程序的运行状态有太大的影响。因此，我们需要对输入进行归一化处理\n1.归一化操作 归一化操作其实很简单，借助sinx的周期性，在本程序中归一化操作如下\nconst float T = 2 * pi; // sinx周期为2pi float fun_sin(float x){ ... int n = (int)(x / T); // 计算周期数量 x -= n * T; // sin(x) = sinx(x - 2n*pi) ... } 2.对除法的优化 在某些平台上，比如DSP芯片中，我们不希望程序中出现除法操作，因为除法是一个非常耗时的操作。在很多DSP芯片中加法和乘法是基本计算操作，cpu只需要一个指令就能完成，但是除法是非常耗时的，所以我们可以尝试改写一下，将其变成乘法的形式\nconst float T = 2 * pi const float f = 1 / T // 编译阶段执行 float fun_sin(float x){ ... x -= T * (int)(x * f) ... } 我们把涉及到除法的部分放到编译阶段执行，这样可以优化在某些不支持快速计算除法的平台上的运行速度\n3.对浮点数截断的操作 这个优化也是在DSP芯片的场景中，我们使用int类型强制转换来对浮点数进行截断操作，这句话看起来很简单，实际上是一个非常复杂的操作，因为浮点数的存储方式不像整型数据那样01排列然后根据二进制计算即可，浮点数有其自己的存储方式。你可以很容易通过整型数据的二进制去计算10进制，但是浮点数的二进制却不是那么容易计算。IEEE754标准就定义了浮点数在二进制中的存储格式，这里不做过多介绍。\n总之知道存储格式后我们可以通过位运算去进行浮点数截断的操作，我之前在CCSV5.5仿真TMS320VC5509A芯片的平台上测试过，这个方法确实可以提升程序运行速度，甚至比库函数还快，但是在x86平台上几乎没有多少提升。（代码是参考网上一篇文章的，但是我忘记链接了\u0026hellip;）\nunion FloatBit { float f; int f_b; } ret, bias; int Float2Int(float f) // 快速转换浮点数为整数 { ret.f = f; bias.f_b = (23l + 127l) \u0026lt;\u0026lt; 23; if (f \u0026lt; 0.0f) { bias.f_b = ((23l + 127l) \u0026lt;\u0026lt; 23) + (1l \u0026lt;\u0026lt; 22); } ret.f += bias.f; ret.f_b -= bias.f_b; return ret.f_b; } 需要注意你的平台上int位数应该和float一样都是32位，如果int是是16位应该换成long或者其他32位的整型类型。\n最终我们优化完的程序如下：\n#include \u0026lt;math.h\u0026gt; #define pi 3.14159265 #define degree 1e-2\t// ̩精度设置 const float factor_diff_mem[10] = // 泰勒展开因子 { 1.0, 1.0 / 6, 1.0 / 20, 1.0 / 42, 1.0 / 72, 1.0 / 110, 1.0 / 156, 1.0 / 210, 1.0 / 272, 1.0 / 342}; const float T = 2 * pi; const float f = 1 / (2 * pi); union FloatBit { float f; int f_b; } ret, bias; int Float2Int(float f) // 快速转换浮点数为整数 { ret.f = f; bias.f_b = (23l + 127l) \u0026lt;\u0026lt; 23; if (f \u0026lt; 0.0f) { bias.f_b = ((23l + 127l) \u0026lt;\u0026lt; 23) + (1l \u0026lt;\u0026lt; 22); } ret.f += bias.f; ret.f_b -= bias.f_b; return ret.f_b; } float fun_sin(float x) { float sum; float diff; int i; float term; x -= T * Float2Int(x * f); sum = x; term = x; diff = -1 * x * x; for (i = 1; fabs(term) \u0026gt; degree; i++) { term *= diff * factor_diff_mem[i]; sum += term; } return sum; } ","permalink":"https://againwq.github.io/posts/linux_c/c%E5%AE%9E%E7%8E%B0sinx%E5%B9%B6%E4%BC%98%E5%8C%96/","summary":"一、sinx泰勒展开的C实现 1.sinx泰勒展开公式 sinx的泰勒展开如下： $$ sinx = x - \\frac{x^3}{3!} + \\frac{x^5}{5!} - \\frac{x^7}{7!} + \u0026hellip; + \\frac{(-1)^n}{(2n + 1)!}x^{2n+1} $$\n其中n从0开始计算，我采用的公式形态上是x=0处的泰勒展开。实际上我们可以把x写成$x = x + x_0$来实现$x=x_0$处的展开\n2.C实现sinx泰勒展开 我们通过控制精度来控制展开项数，并且我们只考虑$0-2\\pi$的范围，归一化处理我们之后再详细考虑，通过泰勒展开公式我们的C程序如下，\n#include \u0026lt;math.h\u0026gt; #define degree 1e-2 float fun_sin(float x) { float res, term; int i; int factor; // 阶乘 term = x; // 每一项的结果 factor = 1; res = term; for (i = 1; fabs(term) \u0026gt; degree; i++) { factor *= (2 * i) * (2 * i + 1); term = pow(-1, i) * pow(x, 2 * i + 1) / factor; res += term; } return res; } 上面的代码基本是严格按照公式计算的，可惜的是它并不能正常工作，这涉及到计算阶乘时整数溢出的问题。当输入比较小，比如0.","title":"C使用泰勒展开实现sinx"},{"content":"5G知识点补充 5G系统间消息 系统间消息分类 在5G系统中，系统消息可分为三大类(有的地方是两类, MSI和OSI)：\nMinimum System Information (MSI) \u0026ndash;最小系统消息 包括MIB和SIB1 Remaining Minimum System Information (RMSI) \u0026ndash;剩余最小系统消息 只有SIB1 Other System Information (OSI)\u0026ndash;其他系统消息 SIB2 ~ SIB9 系统消息传输 发送时，MIB通过RRC消息MasterInformationBlock发送 SIB1通过RRC消息SystemInformationBlock1发送 而SIB2~SIB9封装在称为RRC消息SystemInformation中，并且在SystemInformation消息中具体封装哪些SIB是可配置的，不同小区可配置不同的值。 发送时，MSI被周期性地广播，周期固定。(必须通过广播) OSI的发送方式有两种：一，周期广播，二，动态发送， UE开机接入NR小区后，MIB和SIB1是一定会解读的，而SIB2~9的内容是否需要解读以及何时解读取决于小区配置\n系统消息具体参数 MIB 调制方式QPSK 发送周期80ms 传输信道BCH(映射到PBCH) 获取方式: 小区搜索过程解码PSS和SSS计算出PCI解码MIB 内容: SIB1解码需要的内容(CORESET0)和PDCCH的Search Space, 系统帧号(SFN)、半帧指示、SCS、小区禁止信息 SIB1 传输信道DL-SCH(映射到PDSCH)(PDSCH需要PDCCH调度才能用) 发送周期160ms, SIB1在DL-SCH上以160ms的总传输周期和160ms内的可变传输重复周期(默认20ms)发送. 内容: 小区选择信息、PLMN、TAC、小区标识、RAN通知信息、OSI的SI调度信息、服务小区信息 SIB2: 同频、异频、异系统内小区重选公共参数, 服务频点小区重选相关信息 SIB3: 同频小区重选的邻小区参数 SIB4: 异频小区重选的邻小区参数 SIB5: 异系统小区重选的邻小区参数 5G的MCG和SCG 这个概念是在**EN-DC(双连接场景,即NSA option3场景,终端需要同时连4G与5G网络)**才有的\n双连接概念 EN-DC就是指4G无线接入网与5G NR的双连接(option3, 4G核心网, 4G基站为MN(主节点), 5G基站为SN(辅节点)) NE-DC指5G NR与4G无线接入网的双连接(option4, 5G核心网) NGEN-DC指在5G核心网下的4G无线接入网与5G NR的双连接(option7) MCG与SCG MCG: 主小区组, 下面有PCell(主小区), SCell(辅小区) SCG: 辅小区组, 下面有PSCell(主辅小区), SCell(辅小区) 同一组的不同的小区通过**CA技术(载波聚合)**联合在一起 用于发起初始接入的小区，这个小区称为PCell 车联网知识 频段: 5905 ~ 5925MHz V2X分为两种, DSRC和C-V2X\nC-V2X C-V2X接口 Uu口: 同5G中的Uu接口, UE与基站之间的接口 PC5直连接口: 一种独特的基于4G（或5G）技术的通信接口，它不与公网通信、只用于车-路(RSU)-人之间的信息广播。PC5接口又分为了目前已实现的LTE-V2X（即基于4G的V2X），及尚在完善中的NR-V2X (即基于5G的V2X)。 PC5资源分配模式 LTE-V2X\nmode4: 终端自主的资源分配模式 mode3: 基站集中调度模式； NR-V2X\nmode1: 基站调度UE用于sidelink传输的sidelink资源 mode2: **UE确定（即基站不调度）**由网络配置的sidelink资源或预配置的sidelink传输资源 5G RNTI CS-RNTI: SRS(探测参考信号)用于其加扰的PDCCH进行资源调度 I-RNTI: 寻呼标识, gNB向INACTIVE的UE发送寻呼消息时用到 P-RNTI: 寻呼标识, gNB向ACTIVE的UE发送寻呼消息时用到 C-RNTI: 唯一的UE标识，作为存在RRC连接的标识符 RA-RNTI: 区分用户随机接入响应 SI-RNTI: 系统信息标识, 用来作为下行链路中广播和系统消息识别的标识 SPS C-RNTI: 用法和C-RNTI是一样的，只是使用半静态调度的时候才用; 用于加扰PDSCH 5G测量 涉及到的信号: SSB(多UE通用配置)与CSI-RS(UE专用配置), 这些信号在测量时都以波束(Beam)的形式发出,SSB支持的波束4,8,64 SMTC: SSB测量时机配置, 最多配两个, 即第一个和第二个SSB测量时机的配置 测量事件 A1 - 服务小区测量结果高于门限 A2 - 服务小区测量结果低于门限 A3 - 邻区测量结果高于服务小区测量结果+offset A4 - 邻区测量结果高于门限 A5 - 服务小区测量结果低于门限，并且邻区测量结果高于门限 A6 - 邻区测量结果高于Scell的测量结果+offset B1 - 异系统小区测量结果高于门限 B2 - 异系统小区测量结果高于门限，SPcell测量结果低于门限 5G移动性管理 UE在基站间切换(Xn链路切换) Source gNB发送HandoverRequest, Target gNB回复HandoverRequestAcknowledge, 然后Source gNB发给UE一条RRCReconfiguration(RRC重配置),UE给Target gNB回复重配完成 切换基本流程 测量配置 测量上报 切换执行 如果是从4G切换到5G网络,那么只需要RRC重配即可 5G切换到4G网络,需要网络发送MobilityFromNRCommand命令, 如果切换失败,则需要进行RRC重建(re-establishment) UE切换(NG链路切换) 基站需要与核心网网元AMF进行一个链路切换(NG Path Switch Request),第一条信令为HandoverRequired 5G无线承载控制(补充) SRB分类\nSRB0信令承载0(默认信令承载, 使用CCCH逻辑信道的RRC消息) SRB1信令承载1(UE专用信令承载,使用DCCH信道主要传RRC与NAS信令) SRB2信令承载2(在安全承载建立完成后传输,使用DCCH信道,此时NAS信令用该承载传输) SRB3双连接的情况下(当UE处于EN-DC时使用DCCH逻辑信道的特殊RRC消息) 在EN-DC下SRB1和SRB2支持被配置成Split SRB, Split SRB支持双连接(普通的SRB1和SRB2不支持)\n5G标识号 PLMN: 公共陆地移动网(Public Land Mobile Network，简称PLMN)可以唯一标识一个通信运营商，其由移动国家代码 (Mobile Country Code , 简称MCC)和移动网络代码(Mobile Network Code , MNC)组成。小区搜索时用到 CI: Cell ID, 小区标识 gNB ID: 基站标识 NCI: NR小区标识, NCI = CI + gNB ID NCGI: NR小区全局标识, NCGI = NCI + PLMN 5G核心网网元补充 AMF UPF SMF PCF: 策略控制功能,支持统一的框架来管理网络行为、PCF从UDM获取到用户的签约策略并下发到AMF和SMF,再由AMF,SMF进一步下方给UE、RAN、和UPF NEF: 网络开放功能, 所有外部应用想要访问5GC内部数据都必须通过NEF UDM: 统一数据管理, 生成3GPP AKA认证凭证、合法拦截功能、签约管理、支持用户隐私保护标识(SUCI)的反隐藏 AUSF: 认证服务器功能 NRF: 网络存储功能 5G信道栅格 FR1支持的信道栅格大小: 15, 30, 100KHz FR2支持的信道栅格大小: 60, 120KHz n41(2.6GHz,TDD)、n78(3.5GHz,TDD)、n79(4.9GHz,TDD)都支持15和30KHz, n28(700M, FDD)只支持100khz 运营商相关 中国移动 频段: 2.6GHz和4.9GHz(FR1的n41和n79) 带宽: 2.6: 160MHz, 4.9: 100MHz, 共260MHz 双工方式: TDD 必选子载波间隔: 30KHz 帧结构: 5ms单周期, 特殊子帧配置6:4:4(2.6GHz), 2.5ms双周期, 特殊子帧配置10:2:2(4.9GHz) 中国电信和联通 频段: 3.5GHz(FR1的n78) 带宽: 都是100MHz 双工方式: TDD 帧结构: 2.5ms双周期, 特殊子帧配置10:2:2 ","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85/","summary":"5G知识点补充 5G系统间消息 系统间消息分类 在5G系统中，系统消息可分为三大类(有的地方是两类, MSI和OSI)：\nMinimum System Information (MSI) \u0026ndash;最小系统消息 包括MIB和SIB1 Remaining Minimum System Information (RMSI) \u0026ndash;剩余最小系统消息 只有SIB1 Other System Information (OSI)\u0026ndash;其他系统消息 SIB2 ~ SIB9 系统消息传输 发送时，MIB通过RRC消息MasterInformationBlock发送 SIB1通过RRC消息SystemInformationBlock1发送 而SIB2~SIB9封装在称为RRC消息SystemInformation中，并且在SystemInformation消息中具体封装哪些SIB是可配置的，不同小区可配置不同的值。 发送时，MSI被周期性地广播，周期固定。(必须通过广播) OSI的发送方式有两种：一，周期广播，二，动态发送， UE开机接入NR小区后，MIB和SIB1是一定会解读的，而SIB2~9的内容是否需要解读以及何时解读取决于小区配置\n系统消息具体参数 MIB 调制方式QPSK 发送周期80ms 传输信道BCH(映射到PBCH) 获取方式: 小区搜索过程解码PSS和SSS计算出PCI解码MIB 内容: SIB1解码需要的内容(CORESET0)和PDCCH的Search Space, 系统帧号(SFN)、半帧指示、SCS、小区禁止信息 SIB1 传输信道DL-SCH(映射到PDSCH)(PDSCH需要PDCCH调度才能用) 发送周期160ms, SIB1在DL-SCH上以160ms的总传输周期和160ms内的可变传输重复周期(默认20ms)发送. 内容: 小区选择信息、PLMN、TAC、小区标识、RAN通知信息、OSI的SI调度信息、服务小区信息 SIB2: 同频、异频、异系统内小区重选公共参数, 服务频点小区重选相关信息 SIB3: 同频小区重选的邻小区参数 SIB4: 异频小区重选的邻小区参数 SIB5: 异系统小区重选的邻小区参数 5G的MCG和SCG 这个概念是在**EN-DC(双连接场景,即NSA option3场景,终端需要同时连4G与5G网络)**才有的\n双连接概念 EN-DC就是指4G无线接入网与5G NR的双连接(option3, 4G核心网, 4G基站为MN(主节点), 5G基站为SN(辅节点)) NE-DC指5G NR与4G无线接入网的双连接(option4, 5G核心网) NGEN-DC指在5G核心网下的4G无线接入网与5G NR的双连接(option7) MCG与SCG MCG: 主小区组, 下面有PCell(主小区), SCell(辅小区) SCG: 辅小区组, 下面有PSCell(主辅小区), SCell(辅小区) 同一组的不同的小区通过**CA技术(载波聚合)**联合在一起 用于发起初始接入的小区，这个小区称为PCell 车联网知识 频段: 5905 ~ 5925MHz V2X分为两种, DSRC和C-V2X","title":"5G知识点补充"},{"content":"5G物理层过程概述 物理层,即PHY层\n物理层主要功能 物理信道调制与解调 频率与时间同步 无线特征测量, 并向高层提供指示 MIMI天线处理 物理射频处理 5G的NR帧结构 见物理信道与信号那一篇\n5G 帧结构配置 半静态配置: RRC配置, 小区专用与UE专用两种方式 动态配置: DCI(上行信道信息)配置, 使用SFI(时隙格式指示)和DCI调度两种方式 支持不同周期的配置 支持双周期配置 具体见物理信道与信号那一篇\n物理层资源 基本时间为Tc = 1 / (f * N), 4G是其64倍\n天线端口 小区搜索 PCI = PSS + 3 * SSS 获得PCI可以得到DMRS(解调参考信号)以解调PBCH信道 MIB消息在PBCH上传输 SIB1消息在PDCCH和PDSCH上传输 PLMN PLMN分为手动和自动模式\n频点选择 根据栅格计算频点\n小区搜索 PSS 3条长度为127的伪随机序列,采用BPSK M序列 中间连续127个子载波, 两侧加8和9个保护间隔, 共144个子载波 PSS提供的计算PCI的N取值0,1,2 SSS 336条长度为127的伪随机序列,采用BPSK M序列 中间连续127个子载波, 两侧加8和9个保护间隔, 共144个子载波 SSS提供的计算PCI的N取值0 ~ 355 PCI PCI是物理小区ID, NR中,总共有1008个物理层小区ID UE获取PCI后, 解调DMRS for PBCH, 获取SSB的位置索引 PSS和SSS资源位置 PSS、SSS和PBCH构成SSB PSS、SSS、和PBCH公用天线端口号P=4000 SSB的子载波间隔不能取μ=2,即60KHz, μ=0,1为typeA, μ=3,4为typeB SSB最长符号数可取4,8,64(一个半帧内5ms, typeA) SSB周期: 5ms, 10ms, 20ms, 40ms, 80ms, 160ms 在初始小区搜索过程中,终端假定SSB周期为20ms SSB详细见物理信道与信号 小区选择和重选 小区选择 概述 UE在RRC_IDLE和RRC_INACTIVATE状态下进行 UE需要先完成PLMN的选择(小区搜索的部分), 在已选择的PLMN上选择合适的小区,获取合适的服务,监听控制信道,这个过程即小区选择过程 根据小区重选准则, UE寻找其他更合适的小区进行小区重选,重选后的小区若不属于UE已注册的TAC列表内,UE需要发起位置登记 小区禁止参数在MIB中给出(cellBarred) 小区预留参数在SIB1中给出(cellReservedForOperatorUse) 小区选择策略 UE先通过小区测量,测量波束强度再进行小区选择 多波束情况下,UE根据检测到的SSB最大波束测量值与门限对比,若大于门限值,则选择这个最强波束的小区,否则对检测到的所有最强波束进行线性平均,作为小区的最终测量值 相比于4G, 5G小区选择多了一个Qoffsettemp参数 小区重选 小区重选过程 小区重选是根据**频点优先级(SSB的频点优先级,0 ~ 7)**进行重选的 频点优先级获取方式: 系统消息和专用信令(如RRC Release消息) 重选流程: 重选参数获取 -\u0026gt; 邻区启测判决 -\u0026gt; 小区重选判决 重选参数获取 注: 只有SIB系统消息,没有MIB系统消息\n邻区启测判决 重选判决 都需要满足UE在服务小区驻留超过1s 随机接入(RA) 小区选择完成的是UE与基站下行同步, 随机接入要完成上行同步 包括竞争随机接入和非竞争随机接入 随机接入的场景 前导码(Preamble) 前导码分为长序列和短序列, 具体见物理信道与信号的PRACH(随机接入信道) 4G与5G RA的区别 5G中的RA, UE总是选择最好的beam, 即波束来执行RA过程 UE在SIB1消息读取到RACH信道的配置信息 基于竞争的随机接入 UE收到的msg2的资源不可用, 需要等待一个间隔重新发送msg1,这个间隔是BI msg2过程是在PDSCH进行的,在这之前需要在PDCCH信道中找到调度PDSCH的资源, 寻找的依据是RAPID, 具体来说是RAPID中的RA-RNTI 基于非竞争的RA 基于竞争的RA是随机选择Preamble码, 而非竞争的RA是由上层指定Preamble码 随机接入的具体过程 gNB向UE下发SIB1：这是启动随机接入过程的第一步，gNB通过下行控制信息(DCI)格式1_0，携带SI-RNTI(广播网络临时标识),通过PDCCH或PDSCH通道发送给UE，指示其进行随机接入 UE获取PRACH资源配置：UE通过监听PDCCH或PDSCH通道，获取gNB分配的随机接入资源，这包括PRACH的时频位置和长度等信息 UE传输PRACH Preamble(msg1)：UE在PRACH信道上发送带有PA-RNTI的PRACH Preamble，该Preamble是UE的随机接入尝试的一部分 gNB发送DCI格式1_0：gNB在检测到UE发送的PRACH Preamble后，通过DCI格式1_0，携带RA-RNTI，并在PDCCH或PDSCH上发送，以回应UE的随机接入尝试 gNB通过PDCCH或PDSCH发送MSG2：此信令中包含了TC-RNTI、跟踪区域（TA）和上行许可（UL-Grant），是gNB对UE随机接入尝试的响应 UE通过PUSCH信道发送MSG3：UE在接收到gNB的响应后，通过PUSCH信道发送包含UEID的消息，以完成随机接入过程的这一阶段 gNB发送DCI格式1_0：gNB再次通过DCI格式1_0，携带TC-RNTI，分配资源用于UE的链接响应 gNB通过PDCCH或PDSCH发送MSG4：此信令中包含了UEID，是gNB对UE链接响应的确认 UE通过PDCCH或PDSCH发送MSG5：UE在接收到gNB的确认后，通过PDCCH或PDSCH信道发送最后一个消息，以完成随机接入过程 功率控制 功控作用 抑制小区间干扰 省电, 减少发射功率 在小区内, 主要用于补偿路损和阴影 功控分为上行功率控制和下行功率分配\n上行功率控制 PRACH功率控制: UE在UL BWP(上行BWP)确定PRACH的功率 PUSCH功率控制(专门传输Msg3) PUSCH功率控制 PUCCH功率控制 SRS功率控制 波束管理 UE在RRC_ACTIVE和RRC_IDLE都需要进行波束管理\nRRC_ACTIVE: 下行使用CSI-RS和SSB, 上行用SRS RRC_IDLE: 下行用SSB, 上行用PRACH 波束管理包括波束上报, 波束指示,波束恢复 空闲态 下行 基站侧采用窄波束+轮询发送SSB和系统消息 UE侧采用窄波束+轮询接受的方式, 选择合适的波束 上行 就是进行随机接入(采用PRACH信道) 连接态 下行 基站侧进行分级扫描, 波束由宽到窄 UE采用先宽波束+轮询, 再根据接收到的TCI状态,固定接受波角度(不轮询了)使用窄波束 第三阶段, 基站采用波束方向固定+窄波束, UE采用窄波束+轮询 上行 UE完成接入后, 上行通过SRS进行波束训练(不支持波束细化训练) 基站通过参数直接指定上行所使用的波束SRS Resource ID 波束恢复 UE先进行波束失败检测, 然后UE发送BFRQ(波束失败恢复请求), 基站进行新的候选波束的选择,并响应BFRP(波束恢复响应)\n波束恢复请求方式 通过非竞争的PRACH 通过PUCCH FFS: 基于竞争的PRACH HARQ过程(混合自动重传请求) HARQ是FEC和ARQ的一种混合技术机制 HARQ是MAC层的快速传输机制 NR中,上下行均采用异步HARQ 不支持跨小区HARQ重传 HARQ实体和HARQ进程 每个小区有一个HARQ实体,上下行HARQ实体相互独立 HARQ进程数量是UE级配置参数,上行固定16个,下行可配置,最多16个 仅支持顺序HARQ调度 DCI format1_0和1_1会携带部分HARQ信息 DCI中的NDI可以用来判断接受的**TB块(传输块)**是新传块还是重传块 CBG TB: 传输块 CB: 码块 CBG: 码块组 一个TB(包含CRC)超过CB最大长度限定后,TB会被切分成多个CB发送,把一个TB切分成的CB进行分组(而不是整个一起传),每个组叫做CBG\n一个TB最大的CBG个数: 2,4,6,8(需要RRC高层配置) ","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E7%89%A9%E7%90%86%E5%B1%82%E8%BF%87%E7%A8%8B/","summary":"5G物理层过程概述 物理层,即PHY层\n物理层主要功能 物理信道调制与解调 频率与时间同步 无线特征测量, 并向高层提供指示 MIMI天线处理 物理射频处理 5G的NR帧结构 见物理信道与信号那一篇\n5G 帧结构配置 半静态配置: RRC配置, 小区专用与UE专用两种方式 动态配置: DCI(上行信道信息)配置, 使用SFI(时隙格式指示)和DCI调度两种方式 支持不同周期的配置 支持双周期配置 具体见物理信道与信号那一篇\n物理层资源 基本时间为Tc = 1 / (f * N), 4G是其64倍\n天线端口 小区搜索 PCI = PSS + 3 * SSS 获得PCI可以得到DMRS(解调参考信号)以解调PBCH信道 MIB消息在PBCH上传输 SIB1消息在PDCCH和PDSCH上传输 PLMN PLMN分为手动和自动模式\n频点选择 根据栅格计算频点\n小区搜索 PSS 3条长度为127的伪随机序列,采用BPSK M序列 中间连续127个子载波, 两侧加8和9个保护间隔, 共144个子载波 PSS提供的计算PCI的N取值0,1,2 SSS 336条长度为127的伪随机序列,采用BPSK M序列 中间连续127个子载波, 两侧加8和9个保护间隔, 共144个子载波 SSS提供的计算PCI的N取值0 ~ 355 PCI PCI是物理小区ID, NR中,总共有1008个物理层小区ID UE获取PCI后, 解调DMRS for PBCH, 获取SSB的位置索引 PSS和SSS资源位置 PSS、SSS和PBCH构成SSB PSS、SSS、和PBCH公用天线端口号P=4000 SSB的子载波间隔不能取μ=2,即60KHz, μ=0,1为typeA, μ=3,4为typeB SSB最长符号数可取4,8,64(一个半帧内5ms, typeA) SSB周期: 5ms, 10ms, 20ms, 40ms, 80ms, 160ms 在初始小区搜索过程中,终端假定SSB周期为20ms SSB详细见物理信道与信号 小区选择和重选 小区选择 概述 UE在RRC_IDLE和RRC_INACTIVATE状态下进行 UE需要先完成PLMN的选择(小区搜索的部分), 在已选择的PLMN上选择合适的小区,获取合适的服务,监听控制信道,这个过程即小区选择过程 根据小区重选准则, UE寻找其他更合适的小区进行小区重选,重选后的小区若不属于UE已注册的TAC列表内,UE需要发起位置登记 小区禁止参数在MIB中给出(cellBarred) 小区预留参数在SIB1中给出(cellReservedForOperatorUse) 小区选择策略 UE先通过小区测量,测量波束强度再进行小区选择 多波束情况下,UE根据检测到的SSB最大波束测量值与门限对比,若大于门限值,则选择这个最强波束的小区,否则对检测到的所有最强波束进行线性平均,作为小区的最终测量值 相比于4G, 5G小区选择多了一个Qoffsettemp参数 小区重选 小区重选过程 小区重选是根据**频点优先级(SSB的频点优先级,0 ~ 7)**进行重选的 频点优先级获取方式: 系统消息和专用信令(如RRC Release消息) 重选流程: 重选参数获取 -\u0026gt; 邻区启测判决 -\u0026gt; 小区重选判决 重选参数获取 注: 只有SIB系统消息,没有MIB系统消息","title":"5G物理层过程"},{"content":"5G网络架构 5G网络架构概述 5G移动通信系统包括5GC(5G核心网)和NG-RAN(无线接入网) ng-eNB: 增强型4G基站,可完成部分5G功能 gNB: 5G基站(对应4G中的eNB) Xn接口: 基站间接口(对应4G中的X2接口),传输数据和信令 NG接口: 接入网网元接入到核心网的接口(对应4G中的S1接口) 5G核心网网元: AMF, UPF, SMF AAU: RRU(射频单元) + 天线 CU和DU: CU是集中单元,DU是分布单元,CU、DU可以集中部署也可以分开部署 5G基站 = CU + DU + AAU,但是CU一般集中部署在靠近5GC的位置,AAU部署在靠近UE端的位置\n核心网和接入网的架构演进 核心网架构演进 接入网架构演进 需要注意5G中接入网各个网元与协议栈对应关系\nCU: RRC层 + PDCP层 DU: RLC层 + MAC层 + 部分PHY层 AAU: 部分PHY层 5G网元功能及其接口 5G网元以及接口表示 点对点接口表示(N1,N2,N3 \u0026hellip;.) 服务接口表示(基于服务的接口表示,Nnssf,Nnef\u0026hellip;) CU与DU CU可以分为CU-C(控制面)与CU-U(用户面) CU与DU之间的接口是F1接口 CU-C与CU-U之间的接口是E1接口 CU包含RRC层与PDCP层, CU-C包含RRC与PDCP的控制面功能,CU-U就包含PDCP的用户面功能 CU与DU的协议栈划分:\nCU占的协议栈越多,越方便控制面集中,集中化调度性能提升,但是传输带宽会升高,时延要求也更高(要求时延越低) 3GPP标准划分方案为Option2,将PDCP划分到CU中,PDCP上移容易形成数据锚点,便于支持双链接/单连接 5G主要网元功能 UFP\ngNB间切换的本地移动锚点 连接到移动通信网络外部的PDU会话点 用户数据包的路由与转发 对用户的Qos流的映射与处理 SMF\nPDU会话的建立与删除 UE IP地址的分配 选择控制用户控制面功能(选择UPF) Qos的策略与控制 AMF\nNAS信令及信令的加密与完整性保护 为在UE与SMF之间的SM消息提供传输 用户鉴权及密钥管理 连接与注册管理 CU-C\nXn、E1、F1、NG接口的管理 连接管理(单连接、双连接、多连接等) 系统间和系统内负载均衡 系统间和系统内切片资源管理 CU-U\n数据包的处理与转换\nDU\n资源的调度 信道映射(MAC层) 传输模式的转换(RLC层) AAU-RF\n信号的收发 MIMO天线处理 AAS实现机制 频率与时间同步 5G各个接口协议栈 NG接口(5GC与NG-RAN)\nXn接口(gNB之间)\nE1接口(CU-C与CU-U)\n该接口只有控制面(只传输信令)\nF1接口(CU与DU)\n主要就是控制面用SCTP协议,用户面用GTP-U + UDP协议\nUu口协议栈(UE与基站之间的接口) 控制面\nRRC层是作为一个代表在UE与gNB之间进行交互的,因此UE的接入过程主要是去看RRC相关的信令流程\n用户面\nQos的映射主要是SDAP层的功能，SDAP是5G中新加入的协议层\n5G组网部署 SA: 独立组网,终端同一时刻只需要接入5G基站,再接入5GC NSA: 非独立组网,终端同一时刻需要同时接入5G和4G基站(5G基站不足以提供完整的5G服务,需要4G基站辅助),再接入4G核心网(EPC)或5G核心网\nSA组网方案(最终目标) option2: gNB + 5GC option5: ng-eNB + 5GC NSA组网方案(过渡方案) option3系列: en-gNB(4G网络中的5G基站) + eNB(4G基站) + EPC(4G核心网) 此时主要通过eNB接入核心网(S1接口), 主要解决5G初期的覆盖范围问题\noption7系列: ng-eNB + gNB + 5GC 此时主要通过ng-eNB接入核心网(NG接口,gNB与核心网无信令交互),主要面向5G容量需求\noption4系列: ng-eNB + gNB + 5GC 此时主要通过gNB接入核心网(NG接口,gNB与核心网进行信令交互)\nCU与DU分离部署方案 eMBB(增强移动带宽场景,高速率,大带宽)业务\n满足带宽与速率要求: 满足容量与覆盖要求: 多个DU联合部署形成DU池\n满足不同时延要求: CU与DU合设降低时延\n大连接m-MTC场景需求\nCU集中部署,DU与AAU就近部署\n注: 理想前传条件下DU集中部署,非理想前传条件下DU在RRU就近部署(远端部署)\n","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E7%BD%91%E9%83%A8%E7%BD%B2/","summary":"5G网络架构 5G网络架构概述 5G移动通信系统包括5GC(5G核心网)和NG-RAN(无线接入网) ng-eNB: 增强型4G基站,可完成部分5G功能 gNB: 5G基站(对应4G中的eNB) Xn接口: 基站间接口(对应4G中的X2接口),传输数据和信令 NG接口: 接入网网元接入到核心网的接口(对应4G中的S1接口) 5G核心网网元: AMF, UPF, SMF AAU: RRU(射频单元) + 天线 CU和DU: CU是集中单元,DU是分布单元,CU、DU可以集中部署也可以分开部署 5G基站 = CU + DU + AAU,但是CU一般集中部署在靠近5GC的位置,AAU部署在靠近UE端的位置\n核心网和接入网的架构演进 核心网架构演进 接入网架构演进 需要注意5G中接入网各个网元与协议栈对应关系\nCU: RRC层 + PDCP层 DU: RLC层 + MAC层 + 部分PHY层 AAU: 部分PHY层 5G网元功能及其接口 5G网元以及接口表示 点对点接口表示(N1,N2,N3 \u0026hellip;.) 服务接口表示(基于服务的接口表示,Nnssf,Nnef\u0026hellip;) CU与DU CU可以分为CU-C(控制面)与CU-U(用户面) CU与DU之间的接口是F1接口 CU-C与CU-U之间的接口是E1接口 CU包含RRC层与PDCP层, CU-C包含RRC与PDCP的控制面功能,CU-U就包含PDCP的用户面功能 CU与DU的协议栈划分:\nCU占的协议栈越多,越方便控制面集中,集中化调度性能提升,但是传输带宽会升高,时延要求也更高(要求时延越低) 3GPP标准划分方案为Option2,将PDCP划分到CU中,PDCP上移容易形成数据锚点,便于支持双链接/单连接 5G主要网元功能 UFP\ngNB间切换的本地移动锚点 连接到移动通信网络外部的PDU会话点 用户数据包的路由与转发 对用户的Qos流的映射与处理 SMF\nPDU会话的建立与删除 UE IP地址的分配 选择控制用户控制面功能(选择UPF) Qos的策略与控制 AMF","title":"5G网络架构及组网部署"},{"content":"5G无线网络技术 5G概述 5G三大业务场景 eMBB: 增强移动带宽场景、连续广域覆盖场景、热点高容量场景、大带宽、高速率、大容量、高覆盖 mMTC: 大连接场景 uRLLC: 低时延、高可靠场景 5G八大关键指标 5G技术点: 移动互联网 + 移动物联网\n5G空口技术框架 5G网络架构 5G网络划分为接入平面、控制平面、转发平面\n接入平面: 统一的多无线接入技术融合、无线资源调度与共享 控制平面: 控制集中化、简单化, 服务差异化、开放化 转发平面: 用户面下沉分布式网关、移动边缘内容与计算 具体看5G网络架构与组网部署的笔记\n大规模天线(Massive MIMO) 主要解决5G的覆盖范围和容量问题\n大规模天线: 大量天线为相对少的用户提供同传服务\n大规模天线概述 5G中天线有水平波束和垂直波束的概念, 4G中没有垂直波束的概念\n大规模天线的技术优势\n大规模天线的几种增益\n阵列增益 分集增益 空间复用增益 干扰抑制增益 波束赋形 对于下行MIMO: 区分数据流,使用DMRS信号(解调参考信号) 对于上行MIMO: 区分用户, 使用DMRS信号(解调参考信号) 波束扫描 在下行过程中, 基站依次使用不同指向的波束发射无线信号,该过程被称作波束扫描, 与此同时,用户测量不同波束发射出的无线信号, 并向基站报告相关信息,基站根据用户报告确定对准该用户的最佳发射波束\n为了快速对准波束, 5G标准采取了分级扫描的策略,即由宽到窄扫描\n波束恢复 PRACH信号是随机接入过程中的信号\n大规模天线的应用场景 热点场景 大型公共集会 3D覆盖场景 UDN技术(超密集网络部署) 增加单位面积内小基站的密度, 可以改善网络覆盖, 提高系统容量(提升容量和连接数)\nUDN关键技术 干扰抑制与管理: 使用DMIMO技术(分布式MIMO)和 Small cell on/off技术(关闭没有用户连接或无需提供额外容量的小小区) 移动性管理: 使用虚拟层技术(把密集部署的小基站构建虚拟多层网络, 分为虚拟层和实体层)和软扇区技术(解决UDN难以部署的问题) 联合传输与反馈 UDN应用场景\n全频谱接入 概念 6GHz以下成为低频段, 6GHz以上成为高频段 30-300GHz称为毫米波, 5G频段包括这两个频段(FR1和FR2) 毫米波常用于短距离通信 毫米波路径损耗大, 不适合远距离通信\n5G高频链路预算\n60GHz必须承受约20dB/km的氧气吸收损耗 运营商将28GHz作为主要测量对象 高频(30-40GHz)比低频(3.5GHz)的路损高18~25dB, NLOS比LOS高20~25dB左右 高频比低频的穿透损耗高, 高损材质下超过11dB NR支持的频段 FR1: 450MHz ~ 6000MHz FR2: 24250MHz ~ 52600MHz 国内3.5G是最佳频谱, 而且可以满足SA组网, 中国目前在评估39GHz的可行性 工信部规划: 3.5G频段分给中国联通和中国电信, 2.6GHz和4.9GHz分给中国移动 5G无线关键技术应用 新型多址 已有多址技术\nFDMA TDMA CDMA OFDMA 优点: 可规避用户间干扰,系统实现容易 缺点: 正交多址系统只能达到容量次优 新型多址\n目前非正交多址的方式只限于mMTC的上行场景\n非正交多址接入(NOMA) 根据用户同时占用所有可用带宽,根据功率域划分用户 优点: 处理过程简单, 易于实现 缺点: 功率域用户不易太多, 否则系统性能会快速下降\nPDMA: 可以在功率域,码域,空域,频域和时域同时或选择性应用的非正交多址技术 优点: 多址寻址能力强,信道容量大,频谱利用率高 缺点: 实现复杂\nMUSA: 码域非正交多址接入,使用非线性SIC接收机\nSCMA: 稀疏码本多址, 通过多维的调制和扩频区分用户\n新型多载波 已有: OFDM传输波形技术\nCP-OFDM: 插入**循环前缀(CP)**的OFDM载波,这会降低频效与能效\n新型多载波\nF-OFDM FBMC(采用滤波器代替CP, 对载波频偏不敏感, 提高了频效与能效) UFMC 目前下行使用CP-OFDM,上行待选两种:\nCP-OFDM, 适用于多流MIMO发送(UE距离基站近时使用) DFT-S-OFDM(SC-FDMA): 适用于单流发送, 提升链路预算(UE距离基站远时使用) 5G先进调制编码分类 调制\n空间调制: 用天线的物理位置携带控制信息 频率正交幅度调制(FQAM): FSK与QAM结合 更高阶的调制: 相比于4G, 5G上行能支持到256QAM, 下行可以支持到1024QAM 编码\nLDPC码: 用于5G的数据信道(原来是Turbo码) Polar码: 用于5G的控制信道(原来是TBCC码) 对于eMBB场景, 上下行数据信道均采用LDPC编码, 上行控制信道采用Polar码, 下行控制信道倾向于采用Polar码(但未确认)\nD2D(终端直通技术) 背景: 满足移动互联网和物联网应用场景的扩大所带来的对**时延和可靠性(uRLLC)**的特殊要求 优势: 端到端ms级用户面时延, 可靠性高达99.999%以上,还可以拓展网络覆盖范围, 是一种无线P2P技术(不是M2M) 应用场景: 实时云计算、增强现实、在线游戏、远程医疗、智能交通、智能电网、实时远程控制、紧急通信等 5G中双工技术 灵活双工技术: 上下行业务需求随时间、地点而变化,灵活双工能根据上下行业务动态分配上下行资源 全双工通信技术: 系统收发同频同时, 理论信道容量可以增加一倍 频谱共享 让多个系统共享使用特定频谱, 改变以往固定频谱分配的方式 目前还只是一种理念 ","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E6%97%A0%E7%BA%BF%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%BA%94%E7%94%A8/","summary":"5G无线网络技术 5G概述 5G三大业务场景 eMBB: 增强移动带宽场景、连续广域覆盖场景、热点高容量场景、大带宽、高速率、大容量、高覆盖 mMTC: 大连接场景 uRLLC: 低时延、高可靠场景 5G八大关键指标 5G技术点: 移动互联网 + 移动物联网\n5G空口技术框架 5G网络架构 5G网络划分为接入平面、控制平面、转发平面\n接入平面: 统一的多无线接入技术融合、无线资源调度与共享 控制平面: 控制集中化、简单化, 服务差异化、开放化 转发平面: 用户面下沉分布式网关、移动边缘内容与计算 具体看5G网络架构与组网部署的笔记\n大规模天线(Massive MIMO) 主要解决5G的覆盖范围和容量问题\n大规模天线: 大量天线为相对少的用户提供同传服务\n大规模天线概述 5G中天线有水平波束和垂直波束的概念, 4G中没有垂直波束的概念\n大规模天线的技术优势\n大规模天线的几种增益\n阵列增益 分集增益 空间复用增益 干扰抑制增益 波束赋形 对于下行MIMO: 区分数据流,使用DMRS信号(解调参考信号) 对于上行MIMO: 区分用户, 使用DMRS信号(解调参考信号) 波束扫描 在下行过程中, 基站依次使用不同指向的波束发射无线信号,该过程被称作波束扫描, 与此同时,用户测量不同波束发射出的无线信号, 并向基站报告相关信息,基站根据用户报告确定对准该用户的最佳发射波束\n为了快速对准波束, 5G标准采取了分级扫描的策略,即由宽到窄扫描\n波束恢复 PRACH信号是随机接入过程中的信号\n大规模天线的应用场景 热点场景 大型公共集会 3D覆盖场景 UDN技术(超密集网络部署) 增加单位面积内小基站的密度, 可以改善网络覆盖, 提高系统容量(提升容量和连接数)\nUDN关键技术 干扰抑制与管理: 使用DMIMO技术(分布式MIMO)和 Small cell on/off技术(关闭没有用户连接或无需提供额外容量的小小区) 移动性管理: 使用虚拟层技术(把密集部署的小基站构建虚拟多层网络, 分为虚拟层和实体层)和软扇区技术(解决UDN难以部署的问题) 联合传输与反馈 UDN应用场景","title":"5G无线网络技术"},{"content":"5G物理信道与信号 5G时频域概念 名词解释 CC: 载波, 1个载波可以配置1个或多个BWP BWP: 部分带宽,1个BWP包括n个RB或RBG RBG: 一个RBG等于2,4,8,16个RB,是数据信道PDSCH调度的基本单位 RB: 1个RB等于12个子载波,是数据信道PUSCH调度的基本单位 SCS: 子载波间隔的频率(不是子载波) CCE: 控制信道资源的组成单位,一个CCE=6个REG, 一个PDCCH包含几个CCE, 由聚合等级1,2,4,8,16共5种决定 REG: 控制信道资源分配的基本单位, 频域上1个REG=12个RE,即12个子载波(REG类似于RB), 时域上是1个符号 5G频段介绍 FR1频段: 410MHz \u0026ndash; 7125MHz(Sub6G) FR2频段: 24250MHz \u0026ndash; 52600MHz(毫米波) 与4G相比,取消了1.4M和3MHz的带宽\n注意图中标注的几个频段n28, n41, n79\n5G信道带宽的结构 保护带宽 传输带宽 保护带宽 最大传输带宽 注: FR1和FR2都支持的传输带宽的SCS为 60KHz\n最小保护带宽 双工方式 TDD: 时分双工, 上下行频段相同 FDD: 频分双工, 上下行频段不同 SDL: 补充下行频段, 只有下行频段 SUL: 补充上行频段, 只有上行频段 SDL和SUL频段只能做下行或者上行，因此不能独立工作，仅作为辅助频段，这些频段的频率较低，覆盖性能较好，可用来弥补上下行覆盖的不足。\n工信部分配频段 5G频域资源 BWP 全称Bandwidth Part, 是整个带宽上的一个子集,每个BWP的大小,以及使用的SCS和CP(循环前缀)都可以灵活配置\nDL和UL分别最多可以配置4个专有BWP BWP的带宽必须大于等于SSB,但是BWP中不一定包含SSB 对同一个UE来说,DL或UL同一时刻只能有一个BWP处于激活状态 BWP分为四类,分别是初始BWP, 专用BWP, 激活BWP(UE指定), 默认BWP(UE指定)\nBWP的四种切换情形:\n伴随数据调度的DCI指示的快速切换 RRC(重)配置: 从initial BWP到first active BWP的切换 基于timer的长时间没有业务调度的切换 UE再随机接入过程中,如果active BWP内没有PRACH资源,则自动切换到initial BWP RBG(资源块组) 一个RBG等于2,4,8,16个RB,与BWP的大小有关 RBG用于type0(BitMap, 通过Bit位来确定有无资源块)类型资源配置, type1类型资源配置用到RIV RIV的方式就是指定起始位置和长度 RB RB可以分为CRB和PRB\nCRB: 公共资源块 PRB: 物理资源块, 一个PRB是第几个CRB依赖于 NBWP,istart PointA参考点\n子载波间隔(SCS) μ SCS: f=2μ * 15(kHz) CP(循环前缀) RB带宽(12 * f) 时域 支持物理信道(PDSCH,PUSCH等) 支持同步信道(PSS, SSS, PBCH) 0 15 Normal(14) 180 1ms/时隙 Yes Yes 1 30 Normal(14) 360 0.5ms/时隙 Yes Yes 2 60 Normal(14), Extended(12) 720 0.25ms/时隙 Yes No 3 120 Normal(14) 1440 0.125ms/时隙 Yes Yes 4 240 Normal(14) 2880 0.0625ms/时隙 No Yes 不同SCS大小适合的场景\n5G时域资源 时域帧 无线帧: 10ms 10ms 半帧: 5ms 5ms 5ms 子帧: 1ms 1ms 1ms 1ms 1ms 1ms 时隙 一个子帧包含2μ个时隙(μ取0,1,2,3,4) 例: SCS=30KHz, 即μ=1一个子帧包含2个时隙,每个时隙0.5ms\n符号(根据循环前缀(CP)决定) 普通CP: 一个时隙包含14个符号 扩展CP: 一个时隙包含12个符号\n帧结构 中国移动 用的是5ms双周期(特殊子帧6:4:4) 中国电信和联通 用的是2.5ms双周期(特殊子帧10:2:2)\n帧结构配置 系统消息SIB1消息会在信令中下发帧结构配置,配置结构为:\ndl-UL-TransmissionPeriodicity: 指定配置结构(5ms单周期或2.5ms双周期) 配置四元组: (下行时隙数(D),下行符号,上行时隙数(U),上行符号数), 以5ms单周期为例(7,6,2,4),则上行时隙2个,下行时隙7个,则特殊时隙S = 10-7-2 = 1个,S时隙中包含下行符号6个,上行符号4个,则GP符号为14-6-4=4个 自包含帧结构(uRLLC场景) 根据场景需要适配不同的帧结构\n5G下行物理信道与信号 概览 下行信道\nPBCH: 广播信道(QPSK调制, Polar编码) PDCCH: 下行控制信道(QPSK调制) PDSCH: 下行共享信道(QPSK或16,24,256QAM) 下行信号\nPSS/SSS: 主同步信号和辅同步信号 DM-RS: 解调参考信号 CSI-RS: 信道状态信息参考信号 PT-RS: 信道相位信息参考信号 SSB 基本概念 PSS(主同步信号)与SSS(辅同步信号)和PBCH共同构成一个SSB(SS/PBCH block)\n时域: 占用4个OFDM符号 频域: 共占用240个子载波(20个PRB)(具体大小与子载波间隔有关) PBCH中含有DM-RS DM-RS在PBCH频域上均匀分布,每隔4个子载波有一个DM-RS,DM-RS根据PCI(物理小区ID,0~355) (mod 4)得到在PBCH的起始位置(那么接下来所有位置都知道了),而PCI是在PSS和SSS得到的 PCI = N2ID(PSS得到) + 3 * N1ID(SSS得到)\nSSB的频域位置 KSSB: 低4bit来源于MIB(系统消息), 高4位来源于PBCH OffsetToPointA: 来源于SIB(系统消息) SSB的时域位置 SSB有多种不同的模式(Pattern): Case A, Case B, Case C, Case D\u0026hellip;\n如图所示的Case C, 在2.4GHz以内, 一个半帧(5ms)最多发4个SSB(OFDM 符号), 在大于2.4GHz部分,一个半帧(5ms)最多发8个SSB(OFDM 符号).\nPDCCH信道(下行控制信道, Polar编码, QPSK调制) 主要承载DCI(Downlink Control Information, 下行控制信息).\nPDCCH的时频域确定 NR将PDCCH占用的频域与时域占用的OFDM符号数封装在CORESET中; 将PDCCH起始OFDM符号编号以及PDCCH监测周期等信息封装在Search Space CORESET 1 CCE = 6 REG 1 REG = 1 PRB(RB) 1 REG = 12 RE = 12 子载波(频域) = 1 OFDM 符号(时域) PDCCH聚合等级 PDCCH的聚合等级决定PDCCH包含多少个CCE(1,2,4,8,16)\nUE特定数据的聚合等级为: 1,2,4,8,16 用于资源分配的聚合等级:4,8,16 PDCCH盲检(检测PDCCH的起始位置) 按照聚合度等级从小到大检测\nSearch Space(搜索空间) Search Space分为CSS(公共搜索空间)和USS(终端搜索空间)\nPDSCH信道(下行共享信道) PDSCH时域资源 PDSCH在时域上的分配可以动态变化, 粒度可以到符号级\ntypeA: 起始位置(S)靠前,符号数(L)较多(基于时隙的调度) typeB: 起始位置任意, 符号数较少(适用于低时延的场景) 如图所示(typeA和typeB)\nSLIV负责告诉终端S和L的配置\nPDSCH的频域资源分配 PDSCH支持type0和type1的频域分配\nPDSCH的DMRS时频域分配 时域分配 TypeA类型: 第一个DMRS符号位于时隙中第二个或第三个符号 TypeB类型: 第一个DMRS符号位于分配的PDSCH的第一个符号位置(比较灵活) 针对高速移动的场景,TypeA可以采用附加DMRS的方式提高解调性能, 每个时隙最多配置4个DMRS, 1个前置DMRS和3个附加DMRS(单符号最多配3个附加DMRS,双符号最多配1个附加DMRS)\n频域分配 Type类型由DL-DMRS-Config-Type配置, 默认Type1\nType1: 单符号支持4用户,双符号支持8用户,使用2个CDM组(码分组), 每个端口上DMRS密度为6子载波/PRB Type2: 单符号支持6用户, 双符号支持12用户,使用3个CDM组, 每个端口上DMRS密度为4子载波/PRB(比type1小) CSI-RS(信道状态信息参考信号) 在3GPP 10版本引入, 主要用于获取下行信道状态\nCSI-RS上报模式 CSI-RS上报模式\n周期性上报: 只能用1, 即只能用周期性上报 非周期性上报: 可以用1, 2, 3 半持续上报: 可以用1, 3 CDM-Type(CSI-RS资源映射的码分复用) 不同类型可以复用1, 2, 4, 8个端口(用户)\n5G上行物理信道与信号 物理信道\nPRACH: 随机接入信道 PUCCH: 上行控制信道(QPSK调制) PUSCH: 上行共享信道(QPSK或16,24,256QAM) 物理信号\nSRS: 探测参考信号 DM-RS: 解调参考信号(与下行信道相同) PT-RS: 信道相位信息参考信号(与下行信道相同) PRACH信道(随机接入信道) 主要用于发送随机接入时的前导码(preamble)\n前导码 每个小区只会选择一种前导码用作初始接入, 一个PRACH信道包含64个前导码, 前导码由ZC序列构成\n长格式前导码(长度839) format用数字(0,1,2,3)表示 支持1.25KHz和5KHz两种频率(与之前的子载波间隔区分开) Format1支持最大的覆盖范围 Format0常用于FR1频段 短格式前导码(长度139) format用字母加数字表示(A1,A2,B1,B2,\u0026hellip;.) 短格式前导码覆盖范围比长格式小 f以子载波间隔(SCS)为准 比起长格式,频率普遍较高,时延普遍较低 注: 由于短前导码在时域上占用资源较少, 所以就导致一个slot(时隙)中可以存在多个PRACH资源的情况\nPRACH时域资源 通过PRACH配置索引确定传输的PRACH的format、无线帧号、子帧号、时隙、符号等时域信息, 主要通过查表的方式\nPRACH频域资源 长格式前导码子载波间隔1.25KHz和5KHz两种频率 短格式前导码子载波间隔为15, 30, 60, 120(没有240)KHz\n起点与长度的确定\n长度: nRA 0 ~ M - 1(M为FDM,即频分的个数,可以取1, 2, 4, 8) 起点: nstartRA (PRACH的第一个RB索引), NstartBWP,i: (从PointA开始算,长度为上行激活的BWP) PUCCH(上行控制信道) 主要用于承载UCI(上行控制信息,与DCI对应)\nUCI 调度请求SR(SR用于向gNB申请资源以便进行PUSCH的传输) HARQ反馈(向gNB反馈PDSCH是否正确解码) 信道状态信息CSI(CQI,信道质量指示0~15, PMI等) 注意: UCI可以在PUCCH或PUSCH上传, 但是DCI只能在PDCCH上传\nPUCCH时频资源 PUCCH支持半静态和动态资源分配\n半静态: 高层RRC信令直接配置一个资源, 同时配置一个周期和周期内偏移 动态: 高层RRC信令配置1个或多个PUCCH资源集合, 每个资源集合包含多个PUCCH资源, UE收到下行调度信息后, 会根据DCI中指示的PUCCH resource indicator在1个PUCCH资源集合中找到一个确定的资源 PUCCH有5种格式,format(0, 1, 2, 3, 4).\n格式 时域符号数 频域资源 UCI信息 说明 format0 1~2个OFDM符号 占用1个RB的12个子载波 1~2bit UCI信息 1bit UCI信息时,复用6个用户,2bit时复用3个用户 format1 4~14个OFDM符号 占用1个RB的12个子载波 1~2bit UCI信息 UCI与DMRS间隔放置且DMRS占用的OFDM符号尽可能均分, 频域理论最大12个用户,实际最多复用6个用户. 1bit时BPSK调制, 2bit时QPSK调制 format2 1~2个OFDM符号 1~16个RB 大于2bit UCI DMRS在频域上所占的子载波索引为1,4,7\u0026hellip;只支持QPSK调制, 不支持复用 format3 4~14个OFDM符号 N个RB, N=(1,2,3,4,5,6,8,9,10,12,15,16) 大于2bit UCI 只支持单用户(不支持复用),最多承载4608bit, 采用QPSK调制 format4 4~14个OFDM符号 占用1个RB的12个子载波 大于2bit UCI 复用能力为2或4 PUSCH(上行共享信道) PUSCH时域资源 与PDSCH类似\n都使用SLIV表示时域资源的起始符号(S)和长度(L) PUSCH也支持TypeA和TypeB 与PDSCH不同的是PUSCH的TypeB可以支持1~14个符号 PUSCH频域资源 与PDSCH类似\n支持基于Bitmap的位图分配(Type0) 支持基于RIV的分配(Type1) SRS(探测参考信号) 作用 评估上行的信道参数 上行波束管理 上行波束切换 时域发送方式 周期 半持续 非周期 注: SRS最多配置16个资源集,最多配置64个SRS资源\n","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E7%89%A9%E7%90%86%E4%BF%A1%E9%81%93%E4%B8%8E%E4%BF%A1%E5%8F%B7/","summary":"5G物理信道与信号 5G时频域概念 名词解释 CC: 载波, 1个载波可以配置1个或多个BWP BWP: 部分带宽,1个BWP包括n个RB或RBG RBG: 一个RBG等于2,4,8,16个RB,是数据信道PDSCH调度的基本单位 RB: 1个RB等于12个子载波,是数据信道PUSCH调度的基本单位 SCS: 子载波间隔的频率(不是子载波) CCE: 控制信道资源的组成单位,一个CCE=6个REG, 一个PDCCH包含几个CCE, 由聚合等级1,2,4,8,16共5种决定 REG: 控制信道资源分配的基本单位, 频域上1个REG=12个RE,即12个子载波(REG类似于RB), 时域上是1个符号 5G频段介绍 FR1频段: 410MHz \u0026ndash; 7125MHz(Sub6G) FR2频段: 24250MHz \u0026ndash; 52600MHz(毫米波) 与4G相比,取消了1.4M和3MHz的带宽\n注意图中标注的几个频段n28, n41, n79\n5G信道带宽的结构 保护带宽 传输带宽 保护带宽 最大传输带宽 注: FR1和FR2都支持的传输带宽的SCS为 60KHz\n最小保护带宽 双工方式 TDD: 时分双工, 上下行频段相同 FDD: 频分双工, 上下行频段不同 SDL: 补充下行频段, 只有下行频段 SUL: 补充上行频段, 只有上行频段 SDL和SUL频段只能做下行或者上行，因此不能独立工作，仅作为辅助频段，这些频段的频率较低，覆盖性能较好，可用来弥补上下行覆盖的不足。\n工信部分配频段 5G频域资源 BWP 全称Bandwidth Part, 是整个带宽上的一个子集,每个BWP的大小,以及使用的SCS和CP(循环前缀)都可以灵活配置\nDL和UL分别最多可以配置4个专有BWP BWP的带宽必须大于等于SSB,但是BWP中不一定包含SSB 对同一个UE来说,DL或UL同一时刻只能有一个BWP处于激活状态 BWP分为四类,分别是初始BWP, 专用BWP, 激活BWP(UE指定), 默认BWP(UE指定)","title":"5G物理信号与信道"},{"content":"网络基本架构及接口 5GC（核心网）: AMF（NAS安全,移动性状态管理）,SMF（UE 的ip申请,PDU会话控制）,UPF（PDU管理,移动锚点） NG-RAN（接入网） gNB: 5G基站，由CU+DU构成 Ng接口（接入网与核心网接口）两个层面,用户面与控制面相分离,控制面协议（SCTP, IP, 数据链路层、物理层）, 用户面协议（GTP-U,UDP,IP 数据链路和物理层） Xn接口（gNB,即基站之间的接口）,协议栈Ng相同 F1接口（CU与DU的接口） E1接口（CU与CU的接口）只有控制面协议（SCTP, IP, 数据链路层、物理层） 协议栈见图片\n用户面协议栈 控制面协议栈 5G协议栈 NR无线资源控制层（RRC层） 系统消息广播 RRC连接控制 异系统移动性管理（Inter-RAT） 测量配置和报告 一般性协议错误处理 UE能力转换 NR2层概述 1.SDAP层（服务数据适配层） SDAP子层由RRC配置 SDAO子层将Qos映射到DRBs 在DL中,一个或多个Qos流可能映射到一个DRB 在UL中,一次Qos流仅映射到一个DRB 2.PDCP层（分组数据汇聚层） 数据传输(用户面或控制面) PDCP SN的维护 使用ROHC协议的报头的压缩和解压缩 加密和解密 完整性保护和验证 基于定时器的SDU丢弃 路由重新排序和按顺序交付 重复丢弃 3.RLC层（无线链路控制层） 三种传输模式:TM（透明模式）,UM（非确认模式）,AM（确认模式）\n传送上层PDU 通过ARQ纠错（仅用于AM数据传输） RLC SDU的分段与重组（仅用于UM和AM） RLC SDU的重新分段（UM和AM） 重复检测（AM） RLC SDU丢弃（AM和UM） RLC重建 协议错误检测（AM数据传输） 4.MAC（媒体访问控制） 逻辑信道与传输信道之间的映射 来自一个或不同逻辑信道的MAC SDU多路复用到传输块上以在传送信道上传送到物理层 解复用MAC SDU 调度信息报告 通过HARQ纠错 逻辑通道优先级 MAC层实体处理的传输信道\n广播频道（BCH） 寻呼信道（PCH） 下行链路共享信道（DL-SCH） 上行链路共享信道（UL-SCH） 随机接入信道（RACH） 注:BCCH映射到BCH和DL-SCH,BCCH分为MIB和SIB；MIB经过BCCH-BCH路径,而SIB经过BCCH-DLSCH路径\n物理信道与逻辑信道映射关系(MAC层实现):\n5G接入网信令及接入流程 5G接入网信令 1、5G系统消息获取 UE通过SI消息获取进程获取AS和NAS信息\n2、基于竞争的随机接入 获取到消息后,UE需要通过竞争进行随机接入获取基站分配的资源。\nUE发送preamble序列（前导码）,进行上行同步 基站检测到preamble序列后,发送随机接入响应 UE检测到属于自己的随机接入响应后,利用分配的资源发送信令消息 基站发送冲突解决响应,UE判断是否竞争成功 对于非竞争的随机接入,基站会预先给UE分配一个preamble,UE接入是发送该特定的preamble,基站再响应即可（3步）\n3、RRC连接建立 如果UE Request后基站没有资源,则基站会返回一个拒绝信令,UE收到后会释放MAC层 资源,并启动一个定时器,定时器超时则重新发起连接请求\n4、直传消息 RRC连接状态下传输NAS层的专用信息,NG-RAN到UE或UE到网络\n5、 UE能力传输 当网络需要（额外的）UE的无线接入能力信息是,网络向处于RRC_CONNECTED态的UE启动这个过程（先Network -\u0026gt; UE, UE再响应）\n6、初始加密激活 网络向UE发送SecurityModeCommand 参数,如果UE不支持,则接入过程失败\n7、5G密钥生成 8、5G加密终止点 NAS加密 -\u0026gt; AMF RRC加密 -\u0026gt; gNB User plane Data加密 -\u0026gt; gNB 9、RRC重配置 目的是修改已经建立的RRC连接（Network -\u0026gt; UE, UE再响应） RRC重新配置失败会触发RRC重连\n10、RRC连接重建 UE在RRC_CONNECTED状态下触发重建流程来维持RRC连接（UE主动发起） 一般是在RRC连接出现异常时触发,时机:\n切换失败 重配失败 无线链路失败（检测到RLF） 完保校验失败 重建时会出现UE上下文的问题,重建请求被拒绝不会让UE再次发起请求,而是让基站发起RRCSetUp(此时是新建连接而不是重建了)如图右边所示\n详细过程:\n11、RRC连接挂起 RRC三种状态\nRRC_ACTIVE(CONNECTED) UE 和NG-RAN—connected NG-RAN和5GC—connected RRC_IDLE(空闲模式) UE 和NG-RAN—released NG-RAN和5GC—released RRC_INACTIVE（降低接入时延,节省资源）UE 和NG-RAN—suspend NG-RAN和5GC—connected 在挂起状态要恢复成active状态,如图所示流程\n如果恢复失败（没有UE上下文）基站也会返回RRCSetUp信令,新建RRC连接 如果基站资源不够,无法发起RRCSetUp,则会拒绝恢复请求,如图所示\nRRC连接释放的情况\n12、RRC连接释放 基站发起请求给UE要求释放RRC连接 作用\n释放RRC连接（不携带SuspendConfig）,包括已经建立的无线承载和无线资源 挂起RRC连接,挂起已经建立的无线承载 该过程也可以用于释放和重定向UE到其他节点 13、5G paging 传输寻呼消息给RRC_IDLE或者RRC_INACTIVE状态下的终端 网络初始化寻呼过程,在paging occasion传输Paging message给UE,网络可以通过一条Paging message寻址多个UE(最多同时32个UE)\n14、RAN area 对于处于RRC_INACTIVE的UE 5G中一个TAC下面由多个RAN区域,每个RAN区域由多个小区 UE在同一个RAN的不同小区内进行移动并不会触发RAN的更新,这样可以减少信令的交互过程\n15、RAN更新 UE移动出RNA配置区域 RNA Upate 定时器超时(周期触发) 常规更新(UE移出原本的RNA区域)\n周期更新(定时周期触发,保持连接)\n5G接入流程 1、终端注册流程(随机接入、鉴权、加密等过程完成) 注册成功不代表已经拥有业务承载能力了\n2、 PDU session建立 申请资源的过程\n3、终端发起去注册(核心网处理) 空闲态发起 UE先接入（随机接入+RRC连接建立）然后5GC取消注册,释放UE资源 连接态发起 不需要一个接入过程,直接UE发起注销信令,然后释放UE上下文及空口等资源 4、UE上下文释放 注意:基站(gNB)没有资格主动释放UE上下文,这是异常情况\n5G网络状态及转换 1、注册与连接管理 RM(注册管理) 描述在网络中注册或注销一个UE并在网络中建立该用户的上下文,RM-DEREGISTERED和RM-REGISTERED CM(连接管理) 描述UE和AMF之间的释放和建立信令连接,CM-IDLE和CM-CONNECTED 2、5G RRC状态 X代表不连接，\u0026ndash;代表连接\nRRC_CONNECTED(ACTIVE) UE \u0026ndash; gNB \u0026ndash; 5GC RRC_IDLE UE X gNB X 5GC RRC_INACTIVE UE X gNB \u0026ndash; 5GC UE建立RRC连接后，RRC状态可能是RRC_CONNECTED或者RRC_INACTIVE。UE没有建立RRC连接时，RRC状态为RRC_IDLE\n3、RRC_INACTIVE状态 引入该状态目的是减少接入时延 在这种状态下，终端状态与IDLE态一样，比ACTIVE更省电。当需要转换为ACTIVE态可以快速转换，信令少、时延低 在该状态下UE保持在CM_CONNECTED，可以在配置的NG-RAN区移动时不通知RNA更新 在该状态下，最后服务的gNB节点保留UE上下文以及与UE关联的NG接口上的AMF/UFP信息 4、RRC_INACTIVE到RRC_CONNECTED转换 UE发起Resume请求 在下面几个场景UE会主动发起恢复RRC连接请求\nRAN寻呼 终端发起的NAS信令过程 终端上行数据到达 若获取gNB获取UE报文成功，成功恢复UE上下文，UE成功转换为ACTIVE状态 若获取UE报文失败，Resume失败，则基站需要发起RRCSetUp请求新建RRC连接 若基站侧直接Reject(基站资源不足)，UE会仍然处于INACTIVE状态 详细信令过程\n网络侧主动发起请求 一般是寻呼触发\n5G无线承载控制 SRB分类\nSRB0信令承载0(默认信令承载, 使用CCCH逻辑信道的RRC消息) SRB1信令承载1(UE专用信令承载,使用DCCH信道主要传RRC与NAS信令) SRB2信令承载2(在安全承载建立完成后传输,使用DCCH信道,此时NAS信令用该承载传输) SRB3双连接的情况下(当UE处于EN-DC时使用DCCH逻辑信道的特殊RRC消息) 1、5G Qos概述 5QI: 5G Qos Identifier, Qos标识 ARP: Allocation and Retention Priority, 分配和保留优先级 GRB Qos flow:保证资源的Qos流(上下行带宽) NGRB Qos flow: 非保证资源Qos流 NGRB Qos flow中有一个反射(Reflective)Qos参数，就是根据下行Qos参数直接得到上行Qos参数 5G Qos管理的最小粒度为Qos flow(而不是4G的承载) 单个PDU session在一个用户面隧道承载,并可以传输多个Qos flow的数据报文 多个Qos flow可以根据Qos要求映射到已经建立的RB或者根据需要新建RB来映射\n2、PDU QFI同DRB的映射 一个终端可以建立多个PDU会话 每个PDU session对应一个SDAP实体,每个SDAP实体至少配置一个默认DRB 一个PDU session包含多个Qos flow 多个Qos flow可以映射到同一个DRB 3、PDU会话的建立/更新/释放 PDU会话的建立就是业务承载建立的过程 主要基站与AMF之间的通信\n5G测量与移动性管理 NR测量 gNB采用SSB信号进行测量,SSB可以采用4,8,64个波束\n","permalink":"https://againwq.github.io/posts/%E5%A4%A7%E5%94%90%E6%9D%AF/5g%E4%BF%A1%E4%BB%A4%E4%B8%8E%E5%8D%8F%E8%AE%AE/","summary":"网络基本架构及接口 5GC（核心网）: AMF（NAS安全,移动性状态管理）,SMF（UE 的ip申请,PDU会话控制）,UPF（PDU管理,移动锚点） NG-RAN（接入网） gNB: 5G基站，由CU+DU构成 Ng接口（接入网与核心网接口）两个层面,用户面与控制面相分离,控制面协议（SCTP, IP, 数据链路层、物理层）, 用户面协议（GTP-U,UDP,IP 数据链路和物理层） Xn接口（gNB,即基站之间的接口）,协议栈Ng相同 F1接口（CU与DU的接口） E1接口（CU与CU的接口）只有控制面协议（SCTP, IP, 数据链路层、物理层） 协议栈见图片\n用户面协议栈 控制面协议栈 5G协议栈 NR无线资源控制层（RRC层） 系统消息广播 RRC连接控制 异系统移动性管理（Inter-RAT） 测量配置和报告 一般性协议错误处理 UE能力转换 NR2层概述 1.SDAP层（服务数据适配层） SDAP子层由RRC配置 SDAO子层将Qos映射到DRBs 在DL中,一个或多个Qos流可能映射到一个DRB 在UL中,一次Qos流仅映射到一个DRB 2.PDCP层（分组数据汇聚层） 数据传输(用户面或控制面) PDCP SN的维护 使用ROHC协议的报头的压缩和解压缩 加密和解密 完整性保护和验证 基于定时器的SDU丢弃 路由重新排序和按顺序交付 重复丢弃 3.RLC层（无线链路控制层） 三种传输模式:TM（透明模式）,UM（非确认模式）,AM（确认模式）\n传送上层PDU 通过ARQ纠错（仅用于AM数据传输） RLC SDU的分段与重组（仅用于UM和AM） RLC SDU的重新分段（UM和AM） 重复检测（AM） RLC SDU丢弃（AM和UM） RLC重建 协议错误检测（AM数据传输） 4.MAC（媒体访问控制） 逻辑信道与传输信道之间的映射 来自一个或不同逻辑信道的MAC SDU多路复用到传输块上以在传送信道上传送到物理层 解复用MAC SDU 调度信息报告 通过HARQ纠错 逻辑通道优先级 MAC层实体处理的传输信道\n广播频道（BCH） 寻呼信道（PCH） 下行链路共享信道（DL-SCH） 上行链路共享信道（UL-SCH） 随机接入信道（RACH） 注:BCCH映射到BCH和DL-SCH,BCCH分为MIB和SIB；MIB经过BCCH-BCH路径,而SIB经过BCCH-DLSCH路径","title":"5G信令与协议"},{"content":"","permalink":"https://againwq.github.io/about/","summary":"","title":"About"},{"content":"","permalink":"https://againwq.github.io/tags/","summary":"","title":"Tags"}]